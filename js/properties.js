const propertiesData = [
    {
        "detailsLink": {
            "de": "object-4-de.html",
            "en": "object-4-en.html",
            "ru": "object-4.html",
            "zh": "object-4-zh.html"
        },
        "fallbackImages": [
            "https://images.unsplash.com/photo-1560185007-5f0bb1866cab?auto=format&fit=crop&w=800&q=80"
        ],
        "id": 4,
        "images": [
            "images/object-4/photo_1.jpg",
            "images/object-4/photo_2.jpg",
            "images/object-4/photo_3.jpg"
        ],
        "location": {
            "de": "Malinovka Viertel",
            "en": "Malinovka district",
            "ru": "Район Малиновка",
            "zh": "马林诺夫卡区"
        },
        "price": {
            "de": "€ 275.000*",
            "en": "€ 275,000*",
            "ru": "27 500 000 ₽",
            "zh": "¥ 2,100,000*"
        },
        "stats": {
            "de": "300 m² | Garten 850m²",
            "en": "300 m² | Plot 850m²",
            "ru": "300 м² | Участок 8.5 сот.",
            "zh": "300 平方米 | 占地 850平"
        },
        "title": {
            "de": "Haus 300 m², Zelenogradsk",
            "en": "House 300 m², Zelenogradsk",
            "ru": "Дом 300 м², Зеленоградск",
            "zh": "私人住宅 300 平米 - 泽列诺格勒茨克"
        }
    },
    {
        "detailsLink": {
            "de": "object-5-de.html",
            "en": "object-5-en.html",
            "ru": "object-5.html",
            "zh": "object-5-zh.html"
        },
        "fallbackImages": [
            "https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?auto=format&fit=crop&w=800&q=80"
        ],
        "id": 5,
        "images": [
            "images/object-5/photo_1.jpg"
        ],
        "location": {
            "de": "Kaliningrad, Aksakova Str. 133",
            "en": "Kaliningrad, Aksakova st. 133",
            "ru": "Калининград, ул. Аксакова 133",
            "zh": "加里宁格勒，阿克萨科娃街 133 号"
        },
        "price": {
            "de": "€ 92.000*",
            "en": "€ 92,000*",
            "ru": "9 200 000 ₽",
            "zh": "¥ 700,000*"
        },
        "stats": {
            "de": "64 m² | 3. Stock",
            "en": "64 m² | 3/9 floor",
            "ru": "64 м² | 3/9 этаж",
            "zh": "64 平方米 | 3/9 层"
        },
        "title": {
            "de": "2-Zimmer-Wohnung, 64 m²",
            "en": "2-room apartment, 64 m²",
            "ru": "2-к квартира, 64 м²",
            "zh": "两室公寓，64 平米"
        }
    },
    {
        "detailsLink": {
            "de": "object-6-de.html",
            "en": "object-6-en.html",
            "ru": "object-6.html",
            "zh": "object-6-zh.html"
        },
        "fallbackImages": [
            "https://images.unsplash.com/photo-1502672260266-1c1ef2d93688?auto=format&fit=crop&w=800&q=80"
        ],
        "id": 6,
        "images": [
            "images/object-6/photo_1.jpg"
        ],
        "location": {
            "de": "Kaliningrad, Gromovoy Str. 95",
            "en": "Kaliningrad, Gromovoy st. 95",
            "ru": "Калининград, ул. Громовой 95",
            "zh": "加里宁格勒，格罗莫娃街 95 号"
        },
        "price": {
            "de": "€ 93.500*",
            "en": "€ 93,500*",
            "ru": "9 350 000 ₽",
            "zh": "¥ 720,000*"
        },
        "stats": {
            "de": "72.8 m² | 7. Stock",
            "en": "72.8 m² | 7/10 floor",
            "ru": "72.8 м² | 7/10 этаж",
            "zh": "72.8 平方米 | 7/10 层"
        },
        "title": {
            "de": "3-Zimmer-Wohnung, 72.8 m²",
            "en": "3-room apartment, 72.8 m²",
            "ru": "3-к квартира, 72.8 м²",
            "zh": "三室公寓，72.8 平米"
        }
    },
    {
        "detailsLink": {
            "de": "object-7-de.html",
            "en": "object-7-en.html",
            "ru": "object-7.html",
            "zh": "object-7-zh.html"
        },
        "fallbackImages": [
            "https://images.unsplash.com/photo-1600585154340-be6161a56a0c?auto=format&fit=crop&w=800&q=80"
        ],
        "id": 7,
        "images": [
            "images/object-7/photo_1.jpg"
        ],
        "location": {
            "de": "Kaliningrad, Gagarina Str. 2ak2",
            "en": "Kaliningrad, Gagarina st. 2ak2",
            "ru": "Калининград, ул. Гагарина 2ак2",
            "zh": "加里宁格勒，加加林街 2ak2 号"
        },
        "price": {
            "de": "€ 200.000*",
            "en": "€ 200,000*",
            "ru": "20 000 000 ₽",
            "zh": "¥ 1,540,000*"
        },
        "stats": {
            "de": "65 m² | 4. Stock",
            "en": "65 m² | 4/10 floor",
            "ru": "65 м² | 4/10 этаж",
            "zh": "65 平方米 | 4/10 层"
        },
        "title": {
            "de": "2-Zimmer-Wohnung, 65 m²",
            "en": "2-room apartment, 65 m²",
            "ru": "2-к квартира, 65 м²",
            "zh": "两室公寓，65 平米"
        }
    },
    {
        "detailsLink": {
            "de": "object-8-de.html",
            "en": "object-8-en.html",
            "ru": "object-8.html",
            "zh": "object-8-zh.html"
        },
        "fallbackImages": [
            "https://images.unsplash.com/photo-1512917774080-9991f1c4c750?auto=format&fit=crop&w=800&q=80"
        ],
        "id": 8,
        "images": [
            "images/object-8/photo_1.jpg"
        ],
        "location": {
            "de": "Svetlogorsk, Molodezhnaya Str. 6k2",
            "en": "Svetlogorsk, Molodezhnaya st. 6k2",
            "ru": "Светлогорск, ул. Молодежная 6к2",
            "zh": "斯韦特洛戈尔斯克，青年路 6k2 号"
        },
        "price": {
            "de": "€ 160.000*",
            "en": "€ 160,000*",
            "ru": "16 000 000 ₽",
            "zh": "¥ 1,230,000*"
        },
        "stats": {
            "de": "48.7 m² | 5. Stock",
            "en": "48.7 m² | 5/6 floor",
            "ru": "48.7 м² | 5/6 этаж",
            "zh": "48.7 平方米 | 5/6 层"
        },
        "title": {
            "de": "1-Zimmer-Wohnung, 48.7 m²",
            "en": "1-room apartment, 48.7 m²",
            "ru": "1-к квартира, 48.7 м²",
            "zh": "一室公寓，48.7 平米"
        }
    },
    {
        "detailsLink": {
            "de": "object-9-de.html",
            "en": "object-9-en.html",
            "ru": "object-9.html",
            "zh": "object-9-zh.html"
        },
        "fallbackImages": [
            "https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?auto=format&fit=crop&w=800&q=80"
        ],
        "id": 9,
        "images": [
            "images/object-9/photo_1.jpg"
        ],
        "location": {
            "de": "Svetlogorsk, Mayskiy Proezd 9",
            "en": "Svetlogorsk, Mayskiy ave 9",
            "ru": "Светлогорск, ул. Майский проезд 9",
            "zh": "斯韦特洛戈尔斯克，五月大道 9 号"
        },
        "price": {
            "de": "€ 112.000*",
            "en": "€ 112,000*",
            "ru": "11 200 000 ₽",
            "zh": "¥ 860,000*"
        },
        "stats": {
            "de": "41 m² | 3. Stock",
            "en": "41 m² | 3/6 floor",
            "ru": "41 м² | 3/6 этаж",
            "zh": "41 平方米 | 3/6 层"
        },
        "title": {
            "de": "1-Zimmer-Wohnung, 41 m²",
            "en": "1-room apartment, 41 m²",
            "ru": "1-к квартира, 41 м²",
            "zh": "一室公寓，41 平米"
        }
    }
];

function renderProperties() {
    const container = document.getElementById('catalog-grid');
    if (!container) return;

    const lang = document.documentElement.lang || 'ru';

    container.innerHTML = propertiesData.map(prop => {
        // Build image segments
        const imgs = prop.images && prop.images.length > 0 ? prop.images : [prop.fallbackImages[0]];
        const fallback = prop.fallbackImages || [];

        // Determine link based on language
        let detailsLink = 'https://kaliningrad.etagi.com/realtors/170927/';
        if (prop.detailsLink) {
            if (typeof prop.detailsLink === 'string') {
                detailsLink = prop.detailsLink;
            } else {
                detailsLink = prop.detailsLink[lang] || prop.detailsLink['ru'];
            }
        }

        return `
        <div class="card">
            <div class="card-img">
                <div class="img-slider-container">
                    ${imgs.map((img, idx) => `
                        <img src="${img}" 
                            class="slider-img ${idx === 0 ? 'active' : ''}" 
                            onerror="this.src='${fallback[idx] || fallback[0]}'" 
                            alt="${prop.title[lang]} - ${idx + 1}">
                    `).join('')}
                    <div class="hover-zones">
                        ${imgs.map((_, idx) => `<div class="hover-zone" onmouseenter="switchSliderImg(this, ${idx})"></div>`).join('')}
                    </div>
                </div>
                <div class="card-price">${prop.price[lang]}</div>
                <div class="slider-dots">
                    ${imgs.map((_, idx) => `<span class="dot ${idx === 0 ? 'active' : ''}"></span>`).join('')}
                </div>
            </div>
            <div class="card-body">
                <a href="${detailsLink}" ${prop.detailsLink ? '' : 'target="_blank"'} class="card-title">${prop.title[lang]}</a>
                <div class="card-meta"><i class="fas fa-map-marker-alt"></i> ${prop.location[lang]}</div>
                <div class="card-meta"><span>${prop.stats[lang]}</span></div>
            </div>
        </div>
    `}).join('');
}

// Global function to switch images
window.switchSliderImg = function (element, index) {
    const container = element.closest('.card-img');
    const images = container.querySelectorAll('.slider-img');
    const dots = container.querySelectorAll('.dot');

    images.forEach(img => img.classList.remove('active'));
    dots.forEach(dot => dot.classList.remove('active'));

    if (images[index]) images[index].classList.add('active');
    if (dots[index]) dots[index].classList.add('active');
};

// Global function to pre-fill the form
window.setFormValues = function (type, location) {
    const typeSelect = document.querySelector('select[name="type"]');
    const locSelect = document.querySelector('select[name="location"]');

    if (typeSelect && type) typeSelect.value = type;
    if (locSelect && location) locSelect.value = location;

    // Smooth scroll to quiz
    const quizSection = document.getElementById('quiz');
    if (quizSection) {
        quizSection.scrollIntoView({ behavior: 'smooth' });
    }
};

document.addEventListener('DOMContentLoaded', renderProperties);
