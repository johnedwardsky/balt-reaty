<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BaltHomes Admin</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.14.0/Sortable.min.js"></script>
    <style>
        :root {
            --primary: #0d2e61;
            --accent: #a8844a;
            --bg: #f4f7f6;
            --white: #ffffff;
            --border: #e2e8f0;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: #333;
            margin: 0;
            padding: 0;
        }

        .header {
            background: var(--white);
            padding: 1rem 2rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            font-weight: 700;
            color: var(--primary);
            font-size: 1.25rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--border);
            color: #666;
        }

        .btn-green {
            background: #10b981;
            color: white;
        }

        .btn-primary:hover {
            opacity: 0.9;
        }

        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .nav-tabs {
            display: flex;
            gap: 1rem;
            margin-right: 2rem;
        }

        .nav-tab {
            padding: 0.5rem 1.5rem;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            transition: 0.2s;
        }

        .nav-tab.active {
            background: var(--primary);
            color: white;
        }

        /* PROPERTY LIST */
        .property-list {
            list-style: none;
            padding: 0;
            display: grid;
            gap: 1rem;
        }

        .property-card {
            background: var(--white);
            border-radius: 0.5rem;
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--border);
        }

        .drag-handle {
            color: #ccc;
            cursor: grab;
            padding: 0.5rem;
        }

        .card-img {
            width: 80px;
            height: 60px;
            object-fit: cover;
            border-radius: 4px;
            background: #eee;
        }

        .card-info {
            flex: 1;
        }

        .card-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .card-price {
            color: var(--accent);
            font-size: 0.875rem;
        }

        /* STATS CARDS */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-top: 0.5rem;
        }

        .stat-label {
            color: #666;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* TABLES */
        .stats-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .stats-table th,
        .stats-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .stats-table th {
            background: #f8fafc;
            font-weight: 600;
            color: #475569;
        }

        /* MODAL */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding-top: 2rem;
            padding-bottom: 2rem;
        }

        .modal-content {
            background: white;
            width: 90%;
            max-width: 900px;
            border-radius: 0.75rem;
            padding: 2rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .close-modal {
            position: absolute;
            top: 1rem;
            right: 1.5rem;
            font-size: 1.5rem;
            cursor: pointer;
            color: #999;
        }

        /* FORM TABS */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
            margin-bottom: 1.5rem;
            gap: 2rem;
        }

        .tab-btn {
            background: none;
            border: none;
            padding: 0.75rem 0;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }

        .tab-btn.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            font-size: 0.875rem;
        }

        .form-input,
        .form-textarea {
            width: 100%;
            padding: 0.625rem;
            border: 1px solid var(--border);
            border-radius: 0.375rem;
            font-family: inherit;
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        /* PHOTOS SORTING */
        .photos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .photo-card {
            position: relative;
            background: #eee;
            border-radius: 0.5rem;
            overflow: hidden;
            aspect-ratio: 4/3;
            cursor: grab;
            border: 2px solid transparent;
        }

        .photo-card.selected {
            border-color: var(--primary);
        }

        .photo-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-delete {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(255, 0, 0, 0.8);
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 12px;
        }

        .upload-area {
            border: 2px dashed #cbd5e1;
            border-radius: 0.5rem;
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            margin-bottom: 1rem;
            transition: 0.2s;
        }

        .upload-area:hover {
            border-color: var(--primary);
            background: #f8fafc;
        }

        .feature-badge {
            display: inline-flex;
            align-items: center;
            background: #e0f2fe;
            color: #0369a1;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 12px;
            margin-right: 5px;
            margin-bottom: 5px;
            cursor: pointer;
        }

        .ghost {
            opacity: 0.4;
            background: #c8ebfb;
        }
    </style>
</head>

<body>

    <div class="header">
        <div style="display: flex; align-items: center;">
            <div class="logo">BaltHomes Admin</div>
            <div style="margin-left: 3rem;" class="nav-tabs">
                <div class="nav-tab active" onclick="switchSection('catalog')">–ö–∞—Ç–∞–ª–æ–≥</div>
                <div class="nav-tab" onclick="switchSection('stats')">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
            </div>
        </div>
        <div style="display: flex; gap: 10px;">
            <button class="btn" style="background: #f59e0b; color: white;" onclick="updateSlider()" id="sliderBtn">
                <i class="fas fa-images"></i> –û–±–Ω–æ–≤–∏—Ç—å —Å–ª–∞–π–¥–µ—Ä
            </button>
            <button class="btn btn-outline" onclick="publishPages()" id="pubBtn">
                <i class="fas fa-file-code"></i> –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            </button>
            <button class="btn" style="background: #24292e; color: white;" onclick="deployToGithub()" id="deployBtn">
                <i class="fab fa-github"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ —Å–∞–π—Ç
            </button>
            <button class="btn btn-green" onclick="saveOrder()" id="saveBtn">
                <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫
            </button>
        </div>
    </div>

    <div class="container" id="catalog-section">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <h2>–û–±—ä–µ–∫—Ç—ã –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏</h2>
            <button class="btn btn-primary" onclick="openNewObjectModal()">
                <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –æ–±—ä–µ–∫—Ç
            </button>
        </div>

        <div id="property-list" class="property-list">
            <!-- Items injected by JS -->
        </div>
    </div>

    <div class="container" id="stats-section" style="display: none;">
        <h2>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –ë–∞–Ω–Ω–µ—Ä—ã</h2>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">–ü—Ä–æ—Å–º–æ—Ç—Ä—ã –±–∞–Ω–Ω–µ—Ä–∞</div>
                <div class="stat-value" id="stat-banner-views">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">–ö–ª–∏–∫–∏ –ø–æ –±–∞–Ω–Ω–µ—Ä—É</div>
                <div class="stat-value" id="stat-banner-clicks">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–Ω–Ω–µ—Ä–æ–º</div>
                <div class="form-group" style="margin-top: 1rem;">
                    <label class="form-label" style="font-size: 11px;">–¢–∏–ø –±–∞–Ω–Ω–µ—Ä–∞</label>
                    <select id="bannerType" class="form-input" onchange="updateBannerConfig()"
                        style="padding: 4px; font-size: 12px;">
                        <option value="image">üñºÔ∏è –°—Ç–∞—Ç–∏—á–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</option>
                        <option value="video">üé• –í–∏–¥–µ–æ (–ø–æ —Å—Å—ã–ª–∫–µ)</option>
                    </select>
                </div>
                <div id="videoUrlGroup" class="form-group" style="display: none;">
                    <label class="form-label" style="font-size: 11px;">–°—Å—ã–ª–∫–∞ –Ω–∞ –≤–∏–¥–µ–æ (.mp4 –∏–ª–∏ Kinescope)</label>
                    <input type="text" id="bannerVideoUrl" class="form-input" placeholder="images/banner.mp4"
                        oninput="updateBannerConfig()" style="padding: 4px; font-size: 12px;">
                </div>
                <div id="imageUploadGroup" class="upload-area" onclick="document.getElementById('bannerUpload').click()"
                    style="padding: 0.5rem; margin-top: 0.5rem; font-size: 12px;">
                    <i class="fas fa-image"></i> –û–±–Ω–æ–≤–∏—Ç—å banner.jpeg
                    <input type="file" id="bannerUpload" style="display: none" onchange="uploadBanner(this)">
                </div>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 300px; gap: 2rem;">
            <div>
                <h3 style="margin-bottom: 1rem;">–ü—Ä–æ—Å–º–æ—Ç—Ä—ã –æ–±—ä–µ–∫—Ç–æ–≤</h3>
                <table class="stats-table">
                    <thead>
                        <tr>
                            <th>–û–±—ä–µ–∫—Ç</th>
                            <th>–ü—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</th>
                        </tr>
                    </thead>
                    <tbody id="stat-properties-table">
                        <!-- Rows -->
                    </tbody>
                </table>
            </div>
            <div>
                <h3 style="margin-bottom: 1rem;">–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü</h3>
                <div id="stat-pages-list">
                    <!-- List -->
                </div>
            </div>
        </div>
    </div>

    <!-- EDIT MODAL -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h2 id="modalTitle">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç</h2>
                <button class="btn btn-primary" onclick="saveCurrentObject()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
            </div>

            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('basic')">–û—Å–Ω–æ–≤–Ω–æ–µ</button>
                <button class="tab-btn" onclick="switchTab('details')">–î–µ—Ç–∞–ª–∏ –∏ –û–ø–∏—Å–∞–Ω–∏–µ</button>
                <button class="tab-btn" onclick="switchTab('photos')">–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏</button>
                <button class="tab-btn" onclick="switchTab('map')">–ö–∞—Ä—Ç–∞</button>
            </div>

            <!-- TAB: BASIC -->
            <div id="tab-basic" class="tab-content active">
                <div class="form-group">
                    <label class="form-label">–¢–∏–ø –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏</label>
                    <select id="propertyType" class="form-input" onchange="togglePropertyFields()">
                        <option value="house">üè° –î–æ–º / –ö–æ—Ç—Ç–µ–¥–∂</option>
                        <option value="apartment">üè¢ –ö–≤–∞—Ä—Ç–∏—Ä–∞ / –ê–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã</option>
                        <option value="townhouse">üèòÔ∏è –¢–∞—É–Ω—Ö–∞—É—Å</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ (RU)</label>
                    <input type="text" id="inpTitle" class="form-input">
                </div>
                <div class="grid-2">
                    <div class="form-group">
                        <label class="form-label">–¶–µ–Ω–∞ (RU)</label>
                        <input type="text" id="inpPrice" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">–õ–æ–∫–∞—Ü–∏—è (RU)</label>
                        <input type="text" id="inpLocation" class="form-input">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">ID –û–±—ä–µ–∫—Ç–∞ (–Ω–µ –º–µ–Ω—è–µ—Ç—Å—è)</label>
                    <input type="text" id="inpId" class="form-input" disabled style="background: #eee;">
                </div>
            </div>

            <!-- TAB: DETAILS -->
            <div id="tab-details" class="tab-content">
                <!-- HOUSE FIELDS -->
                <div id="houseFields">
                    <h4 style="margin-bottom: 1rem; color: var(--primary);">–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –¥–æ–º–∞</h4>
                    <div class="grid-2">
                        <div class="form-group">
                            <label class="form-label">–ü–ª–æ—â–∞–¥—å –¥–æ–º–∞ (–º¬≤)</label>
                            <input type="text" id="specHouseArea" class="form-input" placeholder="300">
                        </div>
                        <div class="form-group">
                            <label class="form-label">–£—á–∞—Å—Ç–æ–∫ (—Å–æ—Ç–æ–∫)</label>
                            <input type="text" id="specPlot" class="form-input" placeholder="15">
                        </div>
                        <div class="form-group">
                            <label class="form-label">–≠—Ç–∞–∂–µ–π –≤ –¥–æ–º–µ</label>
                            <input type="text" id="specFloors" class="form-input" placeholder="2">
                        </div>
                        <div class="form-group">
                            <label class="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–Ω–∞—Ç</label>
                            <input type="text" id="specRooms" class="form-input" placeholder="5+">
                        </div>
                        <div class="form-group">
                            <label class="form-label">–ú–∞—Ç–µ—Ä–∏–∞–ª —Å—Ç–µ–Ω</label>
                            <input type="text" id="specMaterial" class="form-input" placeholder="–ö–∏—Ä–ø–∏—á">
                        </div>
                    </div>
                </div>

                <!-- APARTMENT FIELDS -->
                <div id="apartmentFields" style="display: none;">
                    <h4 style="margin-bottom: 1rem; color: var(--primary);">–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∫–≤–∞—Ä—Ç–∏—Ä—ã</h4>
                    <div class="grid-2">
                        <div class="form-group">
                            <label class="form-label">–ü–ª–æ—â–∞–¥—å (–º¬≤)</label>
                            <input type="text" id="specAptArea" class="form-input" placeholder="64">
                        </div>
                        <div class="form-group">
                            <label class="form-label">–≠—Ç–∞–∂ / –≠—Ç–∞–∂–Ω–æ—Å—Ç—å</label>
                            <input type="text" id="specFloor" class="form-input" placeholder="5/9">
                        </div>
                        <div class="form-group">
                            <label class="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–Ω–∞—Ç</label>
                            <input type="text" id="specAptRooms" class="form-input" placeholder="2">
                        </div>
                        <div class="form-group">
                            <label class="form-label">–ü–æ–¥—ä–µ–∑–¥ (–Ω–æ–º–µ—Ä)</label>
                            <input type="text" id="specEntrance" class="form-input" placeholder="1">
                        </div>
                        <div class="form-group">
                            <label class="form-label">–ë–∞–ª–∫–æ–Ω / –õ–æ–¥–∂–∏—è</label>
                            <select id="specBalcony" class="form-input">
                                <option value="">–ù–µ —É–∫–∞–∑–∞–Ω–æ</option>
                                <option value="–ë–∞–ª–∫–æ–Ω">–ë–∞–ª–∫–æ–Ω</option>
                                <option value="–õ–æ–¥–∂–∏—è">–õ–æ–¥–∂–∏—è</option>
                                <option value="2 –±–∞–ª–∫–æ–Ω–∞">2 –±–∞–ª–∫–æ–Ω–∞</option>
                                <option value="–ù–µ—Ç">–ù–µ—Ç</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">–û—Ç–æ–ø–ª–µ–Ω–∏–µ</label>
                            <select id="specHeating" class="form-input">
                                <option value="">–ù–µ —É–∫–∞–∑–∞–Ω–æ</option>
                                <option value="–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–µ">–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–µ</option>
                                <option value="–ê–≤—Ç–æ–Ω–æ–º–Ω–æ–µ">–ê–≤—Ç–æ–Ω–æ–º–Ω–æ–µ</option>
                                <option value="–ì–∞–∑–æ–≤–æ–µ">–ì–∞–∑–æ–≤–æ–µ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">–†–µ–º–æ–Ω—Ç</label>
                            <select id="specRenovation" class="form-input">
                                <option value="">–ù–µ —É–∫–∞–∑–∞–Ω–æ</option>
                                <option value="–ë–µ–∑ —Ä–µ–º–æ–Ω—Ç–∞">–ë–µ–∑ —Ä–µ–º–æ–Ω—Ç–∞</option>
                                <option value="–ö–æ—Å–º–µ—Ç–∏—á–µ—Å–∫–∏–π">–ö–æ—Å–º–µ—Ç–∏—á–µ—Å–∫–∏–π</option>
                                <option value="–ï–≤—Ä–æ—Ä–µ–º–æ–Ω—Ç">–ï–≤—Ä–æ—Ä–µ–º–æ–Ω—Ç</option>
                                <option value="–î–∏–∑–∞–π–Ω–µ—Ä—Å–∫–∏–π">–î–∏–∑–∞–π–Ω–µ—Ä—Å–∫–∏–π</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-group" style="margin-top: 1.5rem;">
                    <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ (HTML –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)</label>
                    <textarea id="inpDesc" class="form-textarea" placeholder="–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞..."></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</label>
                    <textarea id="inpFeatures" class="form-textarea" placeholder="10 –º–∏–Ω –¥–æ –º–æ—Ä—è, –ì–∞–∑, ..."></textarea>
                    <div id="featuresPreview" style="margin-top: 10px;"></div>
                </div>
            </div>

            <!-- TAB: PHOTOS -->
            <div id="tab-photos" class="tab-content">
                <div class="upload-area" onclick="document.getElementById('fileUpload').click()">
                    <i class="fas fa-cloud-upload-alt"
                        style="font-size: 24px; color: var(--primary); margin-bottom: 10px;"></i>
                    <div>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–æ—Ç–æ —Å—é–¥–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏</div>
                    <input type="file" id="fileUpload" multiple accept="image/*" style="display: none"
                        onchange="handleUpload(this)">
                </div>
                <div style="font-size: 12px; color: #666; margin-bottom: 10px;">–ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π—Ç–µ —Ñ–æ—Ç–æ —á—Ç–æ–±—ã –º–µ–Ω—è—Ç—å –ø–æ—Ä—è–¥–æ–∫
                </div>
                <div id="photosGrid" class="photos-grid">
                    <!-- Photos injected here -->
                </div>
            </div>

            <!-- TAB: MAP -->
            <div id="tab-map" class="tab-content">
                <div class="form-group">
                    <label class="form-label">–°—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞—Ä—Ç—É (embed src) –∏–ª–∏ –ø–æ–ª–Ω—ã–π –∫–æ–¥ iframe</label>
                    <textarea id="inpMap" class="form-textarea" placeholder='<iframe src="..."></iframe'></textarea>
                </div>
                <div style="background: #eee; height: 300px; border-radius: 8px; overflow: hidden;" id="mapPreview">
                    <div style="display:flex; justify-content:center; align-items:center; height:100%; color: #999;">
                        –ü—Ä–µ–≤—å—é –∫–∞—Ä—Ç—ã</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let properties = [];
        let currentObjId = null;
        let pListSortable = null;
        let photosSortable = null;

        // --- INIT ---
        async function loadData() {
            const res = await fetch('/api/properties');
            properties = await res.json();
            renderList();
            loadStats();
        }

        async function loadStats() {
            const res = await fetch('/api/stats');
            const stats = await res.json();

            document.getElementById('stat-banner-views').innerText = stats.banner.impressions;
            document.getElementById('stat-banner-clicks').innerText = stats.banner.clicks;

            // Banner Config
            if (stats.banner.config) {
                document.getElementById('bannerType').value = stats.banner.config.type || 'image';
                document.getElementById('bannerVideoUrl').value = stats.banner.config.videoUrl || '';
                toggleBannerInputs();
            }

            const table = document.getElementById('stat-properties-table');
            table.innerHTML = properties.map(p => `
                <tr>
                    <td>${p.title?.ru || '–û–±—ä–µ–∫—Ç ' + p.id}</td>
                    <td><strong>${stats.views[p.id] || 0}</strong></td>
                </tr>
            `).join('');

            const pageList = document.getElementById('stat-pages-list');
            pageList.innerHTML = Object.entries(stats.pages || {}).map(([id, count]) => `
                <div style="display: flex; justify-content: space-between; padding: 10px; background: white; margin-bottom: 5px; border-radius: 8px; border: 1px solid var(--border);">
                    <span>${id}</span>
                    <strong>${count}</strong>
                </div>
            `).join('') || '<p style="color: #999; text-align: center;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</p>';
        }

        function toggleBannerInputs() {
            const type = document.getElementById('bannerType').value;
            document.getElementById('videoUrlGroup').style.display = type === 'video' ? 'block' : 'none';
            document.getElementById('imageUploadGroup').style.display = type === 'image' ? 'block' : 'none';
        }

        async function updateBannerConfig() {
            toggleBannerInputs();
            const config = {
                type: document.getElementById('bannerType').value,
                videoUrl: document.getElementById('bannerVideoUrl').value
            };
            await fetch('/api/banner-config', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(config)
            });
        }

        function switchSection(section) {
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');

            if (section === 'catalog') {
                document.getElementById('catalog-section').style.display = 'block';
                document.getElementById('stats-section').style.display = 'none';
            } else {
                document.getElementById('catalog-section').style.display = 'none';
                document.getElementById('stats-section').style.display = 'block';
                loadStats();
            }
        }

        async function uploadBanner(input) {
            if (!input.files[0]) return;
            const formData = new FormData();
            const blob = input.files[0].slice(0, input.files[0].size, 'image/jpeg');
            const file = new File([blob], 'banner.jpeg', { type: 'image/jpeg' });
            formData.append('image', file);

            await fetch('/api/upload', { method: 'POST', body: formData });
            alert('–ë–∞–Ω–Ω–µ—Ä —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!');
        }

        function openNewObjectModal() {
            currentObjId = Date.now();
            const newObj = {
                id: currentObjId,
                type: 'house',
                title: { ru: '' },
                price: { ru: '' },
                location: { ru: '' },
                images: [],
                specs: { ru: {} },
                description: { ru: '' },
                features: { ru: [] },
                mapUrl: ''
            };
            properties.push(newObj);
            openEdit(currentObjId);
            document.getElementById('modalTitle').innerText = '–ù–æ–≤—ã–π –æ–±—ä–µ–∫—Ç';
        }

        // --- RENDER LIST ---
        function renderList() {
            const list = document.getElementById('property-list');
            list.innerHTML = '';

            properties.forEach(p => {
                const img = (p.images && p.images.length > 0) ? p.images[0] : 'images/placeholder.jpg';
                const div = document.createElement('div');
                div.className = 'property-card';
                div.dataset.id = p.id;
                div.innerHTML = `
                    <div class="drag-handle"><i class="fas fa-grip-vertical"></i></div>
                    <img src="${img}" class="card-img">
                    <div class="card-info">
                        <div class="card-title">${p.title?.ru || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</div>
                        <div class="card-price">${p.price?.ru || ''}</div>
                    </div>
                    <div style="display: flex; gap: 5px;">
                        <button class="btn" style="border: 1px solid #ddd;" onclick="openEdit(${p.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn" style="border: 1px solid #fee2e2; color: #ef4444; background: #fef2f2;" onclick="deleteObject(${p.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                list.appendChild(div);
            });

            if (pListSortable) pListSortable.destroy();
            pListSortable = new Sortable(list, {
                handle: '.drag-handle',
                animation: 150,
                ghostClass: 'ghost',
                onEnd: function () {
                    const newOrderIds = Array.from(list.children).map(el => parseInt(el.dataset.id));
                    const newProps = [];
                    newOrderIds.forEach(id => {
                        newProps.push(properties.find(x => x.id === id));
                    });
                    properties = newProps;
                }
            });
        }

        async function deleteObject(id) {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –æ–±—ä–µ–∫—Ç?')) return;
            properties = properties.filter(p => p.id !== id);
            renderList();
            await saveOrder();
        }

        // --- EDIT MODAL ---
        function togglePropertyFields() {
            const type = document.getElementById('propertyType').value;
            const houseFields = document.getElementById('houseFields');
            const apartmentFields = document.getElementById('apartmentFields');

            if (type === 'apartment') {
                houseFields.style.display = 'none';
                apartmentFields.style.display = 'block';
            } else {
                houseFields.style.display = 'block';
                apartmentFields.style.display = 'none';
            }
        }

        function openEdit(id) {
            currentObjId = id;
            const p = properties.find(x => x.id === id);
            document.getElementById('modalTitle').innerText = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç';

            document.getElementById('propertyType').value = p.type || 'house';
            togglePropertyFields();

            document.getElementById('inpId').value = p.id;
            document.getElementById('inpTitle').value = p.title?.ru || '';
            document.getElementById('inpPrice').value = p.price?.ru || '';
            document.getElementById('inpLocation').value = p.location?.ru || '';

            const specs = p.specs?.ru || {};
            if (p.type === 'apartment') {
                document.getElementById('specAptArea').value = specs.area || '';
                document.getElementById('specFloor').value = specs.floor || '';
                document.getElementById('specAptRooms').value = specs.rooms || '';
                document.getElementById('specEntrance').value = specs.entrance || '';
                document.getElementById('specBalcony').value = specs.balcony || '';
                document.getElementById('specHeating').value = specs.heating || '';
                document.getElementById('specRenovation').value = specs.renovation || '';
            } else {
                document.getElementById('specHouseArea').value = specs.houseArea || specs.Area || '';
                document.getElementById('specPlot').value = specs.landArea || specs.Plot || '';
                document.getElementById('specFloors').value = specs.floors || specs.Floors || '';
                document.getElementById('specRooms').value = specs.rooms || specs.Rooms || '';
                document.getElementById('specMaterial').value = specs.material || '';
            }

            document.getElementById('inpDesc').value = p.description?.ru || '';
            document.getElementById('inpFeatures').value = (p.features?.ru || []).join(', ');
            document.getElementById('inpMap').value = p.mapUrl || '';
            updateMapPreview(p.mapUrl);
            renderPhotos(p.images || []);

            document.getElementById('editModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('editModal').classList.remove('active');
            currentObjId = null;
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('tab-' + tabName).classList.add('active');
        }

        function renderPhotos(images) {
            const grid = document.getElementById('photosGrid');
            grid.innerHTML = '';

            images.forEach((src, idx) => {
                const div = document.createElement('div');
                div.className = 'photo-card';
                div.innerHTML = `
                    <img src="${src}">
                    <div class="photo-delete" onclick="removePhoto(${idx})"><i class="fas fa-times"></i></div>
                `;
                grid.appendChild(div);
            });

            if (photosSortable) photosSortable.destroy();
            photosSortable = new Sortable(grid, {
                animation: 150,
                ghostClass: 'ghost'
            });
        }

        function removePhoto(idx) {
            const p = properties.find(x => x.id === currentObjId);
            p.images.splice(idx, 1);
            renderPhotos(p.images);
        }

        async function handleUpload(input) {
            if (!input.files.length) return;
            const formData = new FormData();
            formData.append('id', currentObjId);
            for (let i = 0; i < input.files.length; i++) {
                formData.append('image', input.files[i]);
            }

            try {
                const res = await fetch('/api/upload', { method: 'POST', body: formData });
                const data = await res.json();
                const p = properties.find(x => x.id === currentObjId);
                if (data.paths) {
                    data.paths.forEach(path => p.images.push(path));
                } else if (data.path) {
                    p.images.push(data.path);
                }
                renderPhotos(p.images);
            } catch (e) {
                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + e);
            }
        }

        function updateMapPreview(val) {
            const container = document.getElementById('mapPreview');
            if (!val) {
                container.innerHTML = '<div style="display:flex; justify-content:center; align-items:center; height:100%; color: #999;">–ü—Ä–µ–≤—å—é –∫–∞—Ä—Ç—ã</div>';
                return;
            }
            let src = val;
            if (val.includes('<iframe')) {
                const match = val.match(/src="([^"]+)"/);
                if (match) src = match[1];
            }
            container.innerHTML = `<iframe src="${src}" width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy"></iframe>`;
        }

        async function saveCurrentObject() {
            if (!currentObjId) return;
            const p = properties.find(x => x.id === currentObjId);
            p.type = document.getElementById('propertyType').value;
            if (!p.title) p.title = {}; p.title.ru = document.getElementById('inpTitle').value;
            if (!p.price) p.price = {}; p.price.ru = document.getElementById('inpPrice').value;
            if (!p.location) p.location = {}; p.location.ru = document.getElementById('inpLocation').value;
            if (!p.description) p.description = {}; p.description.ru = document.getElementById('inpDesc').value;

            if (!p.specs) p.specs = {};
            if (!p.specs.ru) p.specs.ru = {};

            if (p.type === 'apartment') {
                p.specs.ru.area = document.getElementById('specAptArea').value;
                p.specs.ru.floor = document.getElementById('specFloor').value;
                p.specs.ru.rooms = document.getElementById('specAptRooms').value;
                p.specs.ru.entrance = document.getElementById('specEntrance').value;
                p.specs.ru.balcony = document.getElementById('specBalcony').value;
                p.specs.ru.heating = document.getElementById('specHeating').value;
                p.specs.ru.renovation = document.getElementById('specRenovation').value;
            } else {
                p.specs.ru.houseArea = document.getElementById('specHouseArea').value;
                p.specs.ru.landArea = document.getElementById('specPlot').value;
                p.specs.ru.floors = document.getElementById('specFloors').value;
                p.specs.ru.rooms = document.getElementById('specRooms').value;
                p.specs.ru.material = document.getElementById('specMaterial').value;
            }

            const featStr = document.getElementById('inpFeatures').value;
            if (!p.features) p.features = {};
            p.features.ru = featStr.split(',').map(s => s.trim()).filter(s => s);

            p.mapUrl = document.getElementById('inpMap').value;
            const photoGrid = document.getElementById('photosGrid');
            p.images = Array.from(photoGrid.children).map(el => el.querySelector('img').getAttribute('src'));

            closeModal();
            renderList();
            await saveOrder();
        }

        async function saveOrder() {
            const btn = document.getElementById('saveBtn');
            const origText = btn.innerHTML;
            btn.innerHTML = '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...';
            await fetch('/api/properties', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(properties)
            });
            btn.innerHTML = '<i class="fas fa-check"></i> –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ';
            setTimeout(() => btn.innerHTML = origText, 2000);
        }

        async function updateSlider() {
            const btn = document.getElementById('sliderBtn');
            const origText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-sync fa-spin"></i> –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ...';
            try {
                const res = await fetch('/api/update-slider', { method: 'POST' });
                if (res.ok) alert('–°–ª–∞–π–¥–µ—Ä —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!');
                else alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–ª–∞–π–¥–µ—Ä–∞');
            } catch (e) {
                alert('–û—à–∏–±–∫–∞: ' + e);
            }
            btn.innerHTML = origText;
        }

        async function publishPages() {
            const btn = document.getElementById('pubBtn');
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –ì–µ–Ω–µ—Ä–∞—Ü–∏—è...';
            try {
                const res = await fetch('/api/generate-pages', { method: 'POST' });
                if (res.ok) alert('–°—Ç—Ä–∞–Ω–∏—Ü—ã —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω—ã!');
                else alert('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏');
            } catch (e) { alert('–û—à–∏–±–∫–∞: ' + e); }
            btn.innerHTML = '<i class="fas fa-file-code"></i> –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã';
        }

        async function deployToGithub() {
            const btn = document.getElementById('deployBtn');
            const origText = btn.innerHTML;
            btn.innerHTML = 'üöÄ –û—Ç–ø—Ä–∞–≤–∫–∞...';
            btn.disabled = true;
            try {
                await fetch('/api/update-slider', { method: 'POST' });
                await fetch('/api/generate-pages', { method: 'POST' });
                const res = await fetch('/api/deploy', { method: 'POST' });
                if (res.ok) alert('–£—Å–ø–µ—à–Ω–æ! –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—è–≤—è—Ç—Å—è –Ω–∞ —Å–∞–π—Ç–µ —á–µ—Ä–µ–∑ –ø–∞—Ä—É –º–∏–Ω—É—Ç.');
                else alert('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏');
            } catch (e) { alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + e); }
            btn.innerHTML = origText;
            btn.disabled = false;
        }

        loadData();
    </script>
</body>

</html>